#!/usr/bin/env bash
set -e

if [[ -n $OMNIA_DEBUG ]]; then
	env
	set -x
fi

LIB_PATH="$(cd "${0%/*/*}" && pwd)/lib"
source "$LIB_PATH/config.sh"
source "$LIB_PATH/gasprice.sh"
source "$LIB_PATH/ethereum.sh"
source "$LIB_PATH/log.sh"
source "$LIB_PATH/scuttlebot.sh"
source "$LIB_PATH/source.sh"
source "$LIB_PATH/status.sh"
source "$LIB_PATH/util.sh"
source "$LIB_PATH/transport.sh"
source "$LIB_PATH/feed.sh"
source "$LIB_PATH/relayer.sh"
source "$LIB_PATH/omnia.sh"

if [[ "$OMNIA_MODE" == "RELAYER" || "$OMNIA_MODE" == "RELAY" ]]; then
	runRelayer
elif [[ "$OMNIA_MODE" == "FEED" ]]; then
	runFeed
else
	error "Unrecognised OMNIA_MODE"
fi