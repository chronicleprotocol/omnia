#!/usr/bin/env bash
set -e

if [[ -n $OMNIA_DEBUG ]]; then
	env
	set -x
fi

(cd "$(cd "${0%/*/*}" && pwd)/lib"
	source ./config.sh
	source ./gasprice.sh
	source ./ethereum.sh
	source ./log.sh
	source ./scuttlebot.sh
	source ./source.sh
	source ./status.sh
	source ./util.sh
	source ./transport.sh
	source ./feed.sh
	source ./relayer.sh
	source ./omnia.sh

	initEnv
	if [[ "$OMNIA_MODE" == "RELAYER" || "$OMNIA_MODE" == "RELAY" ]]; then
		runRelayer
	elif [[ "$OMNIA_MODE" == "FEED" ]]; then
		runFeed
	else
		error "Unrecognised OMNIA_MODE"
	fi
)